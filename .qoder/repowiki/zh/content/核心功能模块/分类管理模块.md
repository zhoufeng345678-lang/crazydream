# åˆ†ç±»ç®¡ç†æ¨¡å—

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java)
- [CategoryApplicationService.java](file://src/main/java/com/crazydream/application/category/service/CategoryApplicationService.java)
- [CategoryAssembler.java](file://src/main/java/com/crazydream/application/category/assembler/CategoryAssembler.java)
- [CategoryDTO.java](file://src/main/java/com/crazydream/application/category/dto/CategoryDTO.java)
- [CreateCategoryCommand.java](file://src/main/java/com/crazydream/application/category/dto/CreateCategoryCommand.java)
- [Category.java](file://src/main/java/com/crazydream/domain/category/model/aggregate/Category.java)
- [CategoryName.java](file://src/main/java/com/crazydream/domain/category/model/valueobject/CategoryName.java)
- [CategoryRepository.java](file://src/main/java/com/crazydream/domain/category/repository/CategoryRepository.java)
- [CategoryRepositoryImpl.java](file://src/main/java/com/crazydream/infrastructure/persistence/repository/CategoryRepositoryImpl.java)
- [CategoryConverter.java](file://src/main/java/com/crazydream/infrastructure/persistence/converter/CategoryConverter.java)
- [CategoryPersistenceMapper.xml](file://src/main/resources/mapper/CategoryPersistenceMapper.xml)
- [CategoryId.java](file://src/main/java/com/crazydream/domain/shared/model/CategoryId.java)
- [schema.sql](file://src/main/resources/schema.sql)
- [api-documentation.md](file://api-documentation.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–å…³ç³»åˆ†æ](#ä¾èµ–å…³ç³»åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)
10. [é™„å½•](#é™„å½•)

## ç®€ä»‹

åˆ†ç±»ç®¡ç†æ¨¡å—æ˜¯CrazyDreamç›®æ ‡ç®¡ç†ç³»ç»Ÿä¸­çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ä¹‹ä¸€ï¼Œè´Ÿè´£ç®¡ç†ç›®æ ‡çš„åˆ†ç±»ä½“ç³»ã€‚è¯¥æ¨¡å—å®ç°äº†å®Œæ•´çš„åˆ†ç±»ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬åˆ†ç±»çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œæ”¯æŒåˆ†ç±»çŠ¶æ€ç®¡ç†å’Œæ’åºæœºåˆ¶ã€‚

æ¨¡å—é‡‡ç”¨DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰å’ŒCOLAå››å±‚æ¶æ„ï¼Œç¡®ä¿äº†ä»£ç çš„æ¸…æ™°æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚é€šè¿‡å……è¡€æ¨¡å‹å’Œå€¼å¯¹è±¡çš„è®¾è®¡ï¼Œå®ç°äº†ä¸šåŠ¡é€»è¾‘çš„å°è£…å’Œæ•°æ®çš„ä¸€è‡´æ€§ä¿è¯ã€‚

## é¡¹ç›®ç»“æ„

åˆ†ç±»ç®¡ç†æ¨¡å—éµå¾ªCrazyDreamé¡¹ç›®çš„æ ‡å‡†ç›®å½•ç»“æ„ï¼ŒæŒ‰ç…§åŠŸèƒ½åŸŸè¿›è¡Œç»„ç»‡ï¼š

```mermaid
graph TB
subgraph "æ¥å£å±‚"
CC[CategoryController]
end
subgraph "åº”ç”¨å±‚"
CAS[CategoryApplicationService]
CA[CategoryAssembler]
end
subgraph "é¢†åŸŸå±‚"
C[Categoryèšåˆæ ¹]
CN[CategoryNameå€¼å¯¹è±¡]
CID[CategoryIdå€¼å¯¹è±¡]
CR[CategoryRepositoryæ¥å£]
end
subgraph "åŸºç¡€è®¾æ–½å±‚"
CRI[CategoryRepositoryImpl]
CCV[CategoryConverter]
CPM[CategoryPersistenceMapper]
end
CC --> CAS
CAS --> CA
CAS --> CR
CA --> C
C --> CN
C --> CID
CR --> CRI
CRI --> CCV
CRI --> CPM
```

**å›¾è¡¨æ¥æº**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java#L1-L83)
- [CategoryApplicationService.java](file://src/main/java/com/crazydream/application/category/service/CategoryApplicationService.java#L1-L48)
- [CategoryRepositoryImpl.java](file://src/main/java/com/crazydream/infrastructure/persistence/repository/CategoryRepositoryImpl.java#L1-L59)

**ç« èŠ‚æ¥æº**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java#L1-L83)
- [CategoryApplicationService.java](file://src/main/java/com/crazydream/application/category/service/CategoryApplicationService.java#L1-L48)

## æ ¸å¿ƒç»„ä»¶

### æ•°æ®æ¨¡å‹è®¾è®¡

åˆ†ç±»ç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®æ¨¡å‹ç”±å¤šä¸ªå±‚æ¬¡ç»„æˆï¼Œç¡®ä¿äº†æ•°æ®çš„å®Œæ•´æ€§å’Œä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§ï¼š

```mermaid
classDiagram
class Category {
-CategoryId id
-CategoryName name
-String icon
-String color
-Integer sort
-boolean enabled
+create(name, icon, color, sort) Category
+rebuild(id, name, icon, color, sort, enabled) Category
+update(name, icon, color, sort) void
+disable() void
+enable() void
+getId() CategoryId
+getName() CategoryName
+getIcon() String
+getColor() String
+getSort() Integer
+isEnabled() boolean
}
class CategoryName {
-String value
+of(value) CategoryName
+getValue() String
}
class CategoryId {
-Long value
+of(value) CategoryId
+getValue() Long
}
class CategoryDTO {
-Long id
-String name
-String icon
-String color
-Integer sort
-Boolean enabled
}
class CreateCategoryCommand {
-String name
-String icon
-String color
-Integer sort
}
Category --> CategoryName : "ä½¿ç”¨"
Category --> CategoryId : "ä½¿ç”¨"
CategoryAssembler --> CategoryDTO : "è½¬æ¢"
CategoryAssembler --> CreateCategoryCommand : "è½¬æ¢"
```

**å›¾è¡¨æ¥æº**
- [Category.java](file://src/main/java/com/crazydream/domain/category/model/aggregate/Category.java#L1-L83)
- [CategoryName.java](file://src/main/java/com/crazydream/domain/category/model/valueobject/CategoryName.java#L1-L34)
- [CategoryId.java](file://src/main/java/com/crazydream/domain/shared/model/CategoryId.java#L1-L48)
- [CategoryDTO.java](file://src/main/java/com/crazydream/application/category/dto/CategoryDTO.java#L1-L14)
- [CreateCategoryCommand.java](file://src/main/java/com/crazydream/application/category/dto/CreateCategoryCommand.java#L1-L12)

### ä¸šåŠ¡è§„åˆ™å’Œçº¦æŸ

åˆ†ç±»ç³»ç»Ÿå®ç°äº†ä¸¥æ ¼çš„ä¸šåŠ¡è§„åˆ™å’Œæ•°æ®çº¦æŸï¼š

1. **åˆ†ç±»åç§°éªŒè¯**ï¼šåç§°ä¸èƒ½ä¸ºç©ºï¼Œè‡ªåŠ¨å»é™¤é¦–å°¾ç©ºæ ¼
2. **åˆ†ç±»IDçº¦æŸ**ï¼šIDå¿…é¡»ä¸ºæ­£æ•´æ•°ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
3. **çŠ¶æ€ç®¡ç†**ï¼šæ”¯æŒå¯ç”¨/ç¦ç”¨çŠ¶æ€ï¼Œå½±å“åˆ†ç±»çš„å¯ç”¨æ€§
4. **æ’åºæœºåˆ¶**ï¼šåŸºäºsortå­—æ®µè¿›è¡Œå‡åºæ’åˆ—
5. **å”¯ä¸€æ€§çº¦æŸ**ï¼šæ•°æ®åº“å±‚é¢ä¿è¯åˆ†ç±»åç§°çš„å”¯ä¸€æ€§

**ç« èŠ‚æ¥æº**
- [CategoryName.java](file://src/main/java/com/crazydream/domain/category/model/valueobject/CategoryName.java#L8-L13)
- [CategoryId.java](file://src/main/java/com/crazydream/domain/shared/model/CategoryId.java#L15-L20)
- [schema.sql](file://src/main/resources/schema.sql#L29)

## æ¶æ„æ¦‚è§ˆ

åˆ†ç±»ç®¡ç†æ¨¡å—é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ¯å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£åˆ†å·¥ï¼š

```mermaid
graph TB
subgraph "æ¥å£å±‚"
AC[HTTPè¯·æ±‚å¤„ç†]
VR[å“åº”å°è£…]
end
subgraph "åº”ç”¨å±‚"
AS[åº”ç”¨æœåŠ¡ç¼–æ’]
DTO[DTOè½¬æ¢]
TX[äº‹åŠ¡ç®¡ç†]
end
subgraph "é¢†åŸŸå±‚"
DM[é¢†åŸŸæ¨¡å‹]
VO[å€¼å¯¹è±¡]
BC[ä¸šåŠ¡è§„åˆ™]
end
subgraph "åŸºç¡€è®¾æ–½å±‚"
PR[æŒä¹…åŒ–å®ç°]
MP[MyBatisæ˜ å°„]
DB[(æ•°æ®åº“)]
end
AC --> AS
AS --> DM
AS --> DTO
AS --> TX
DM --> VO
DM --> BC
PR --> MP
PR --> DB
DTO --> PR
```

**å›¾è¡¨æ¥æº**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java#L11-L16)
- [CategoryApplicationService.java](file://src/main/java/com/crazydream/application/category/service/CategoryApplicationService.java#L14-L18)
- [CategoryRepositoryImpl.java](file://src/main/java/com/crazydream/infrastructure/persistence/repository/CategoryRepositoryImpl.java#L16-L20)

### æ§åˆ¶æµåˆ†æ

```mermaid
sequenceDiagram
participant Client as å®¢æˆ·ç«¯
participant Controller as CategoryController
participant Service as CategoryApplicationService
participant Repo as CategoryRepository
participant Converter as CategoryConverter
participant Mapper as CategoryPersistenceMapper
participant DB as æ•°æ®åº“
Client->>Controller : POST /api/v2/categories
Controller->>Service : createCategory(command)
Service->>Converter : toDomain(command)
Converter->>Repo : save(category)
Repo->>Mapper : insert(po)
Mapper->>DB : INSERTè¯­å¥
DB-->>Mapper : è¿”å›ç”Ÿæˆçš„ID
Mapper-->>Repo : POå¯¹è±¡
Repo-->>Service : Categoryå¯¹è±¡
Service-->>Controller : CategoryDTO
Controller-->>Client : ResponseResult
Note over Client,DB : åˆ›å»ºåˆ†ç±»çš„å®Œæ•´æµç¨‹
```

**å›¾è¡¨æ¥æº**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java#L18-L26)
- [CategoryApplicationService.java](file://src/main/java/com/crazydream/application/category/service/CategoryApplicationService.java#L20-L25)
- [CategoryRepositoryImpl.java](file://src/main/java/com/crazydream/infrastructure/persistence/repository/CategoryRepositoryImpl.java#L22-L32)

**ç« èŠ‚æ¥æº**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java#L1-L83)
- [CategoryApplicationService.java](file://src/main/java/com/crazydream/application/category/service/CategoryApplicationService.java#L1-L48)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### æ¥å£æ§åˆ¶å™¨

CategoryControlleræä¾›äº†å®Œæ•´çš„REST APIæ¥å£ï¼Œæ”¯æŒåˆ†ç±»çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼š

#### ä¸»è¦æ¥å£åŠŸèƒ½

| æ¥å£ | æ–¹æ³• | URL | åŠŸèƒ½æè¿° |
|------|------|-----|----------|
| åˆ›å»ºåˆ†ç±» | POST | `/api/v2/categories` | åˆ›å»ºæ–°çš„åˆ†ç±» |
| è·å–æ‰€æœ‰åˆ†ç±» | GET | `/api/v2/categories` | è·å–ç³»ç»Ÿä¸­æ‰€æœ‰åˆ†ç±» |
| è·å–å¯ç”¨åˆ†ç±» | GET | `/api/v2/categories/enabled` | è·å–å¯ç”¨çŠ¶æ€çš„åˆ†ç±» |
| è·å–åˆ†ç±»è¯¦æƒ… | GET | `/api/v2/categories/{id}` | æ ¹æ®IDè·å–åˆ†ç±»è¯¦æƒ… |
| æ›´æ–°åˆ†ç±» | PUT | `/api/v2/categories/{id}` | æ›´æ–°åˆ†ç±»ä¿¡æ¯ |
| åˆ é™¤åˆ†ç±» | DELETE | `/api/v2/categories/{id}` | åˆ é™¤æŒ‡å®šåˆ†ç±» |

#### å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†

æ§åˆ¶å™¨å®ç°äº†å®Œå–„çš„å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†æœºåˆ¶ï¼š

```mermaid
flowchart TD
Start([è¯·æ±‚è¿›å…¥]) --> Validate["éªŒè¯è¯·æ±‚å‚æ•°"]
Validate --> ParamValid{"å‚æ•°æœ‰æ•ˆ?"}
ParamValid --> |å¦| Return400["è¿”å›400é”™è¯¯"]
ParamValid --> |æ˜¯| CallService["è°ƒç”¨åº”ç”¨æœåŠ¡"]
CallService --> ServiceResult{"æœåŠ¡æ‰§è¡ŒæˆåŠŸ?"}
ServiceResult --> |å¦| ReturnError["è¿”å›ç›¸åº”é”™è¯¯"]
ServiceResult --> |æ˜¯| ReturnSuccess["è¿”å›æˆåŠŸå“åº”"]
Return400 --> End([ç»“æŸ])
ReturnError --> End
ReturnSuccess --> End
```

**å›¾è¡¨æ¥æº**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java#L18-L81)

**ç« èŠ‚æ¥æº**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java#L1-L83)

### åº”ç”¨æœåŠ¡å±‚

CategoryApplicationServiceä½œä¸ºåº”ç”¨æœåŠ¡ç¼–æ’å™¨ï¼Œè´Ÿè´£åè°ƒå„ä¸ªç»„ä»¶å®Œæˆä¸šåŠ¡é€»è¾‘ï¼š

#### æ ¸å¿ƒä¸šåŠ¡æµç¨‹

```mermaid
sequenceDiagram
participant Service as åº”ç”¨æœåŠ¡
participant Assembler as è£…é…å™¨
participant Repository as ä»“å‚¨æ¥å£
participant Domain as é¢†åŸŸæ¨¡å‹
Service->>Assembler : è½¬æ¢å‘½ä»¤åˆ°é¢†åŸŸæ¨¡å‹
Assembler->>Domain : åˆ›å»ºCategoryå¯¹è±¡
Service->>Repository : ä¿å­˜Category
Repository->>Domain : è¿”å›æŒä¹…åŒ–åçš„å¯¹è±¡
Service->>Assembler : è½¬æ¢ä¸ºDTO
Assembler-->>Service : è¿”å›CategoryDTO
Service-->>Caller : è¿”å›ç»“æœ
```

**å›¾è¡¨æ¥æº**
- [CategoryApplicationService.java](file://src/main/java/com/crazydream/application/category/service/CategoryApplicationService.java#L20-L25)
- [CategoryAssembler.java](file://src/main/java/com/crazydream/application/category/assembler/CategoryAssembler.java#L12-L19)

#### äº‹åŠ¡ç®¡ç†

åº”ç”¨æœåŠ¡å±‚ä½¿ç”¨@Transactionalæ³¨è§£ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼š

- åˆ›å»ºåˆ†ç±»ï¼šå•ä¸ªäº‹åŠ¡ç¡®ä¿æ•°æ®å®Œæ•´æ€§
- åˆ é™¤åˆ†ç±»ï¼šå•ä¸ªäº‹åŠ¡ç¡®ä¿çº§è”åˆ é™¤çš„ä¸€è‡´æ€§

**ç« èŠ‚æ¥æº**
- [CategoryApplicationService.java](file://src/main/java/com/crazydream/application/category/service/CategoryApplicationService.java#L1-L48)

### é¢†åŸŸæ¨¡å‹

Categoryèšåˆæ ¹å®ç°äº†å……è¡€æ¨¡å‹è®¾è®¡ï¼Œå°è£…äº†å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘ï¼š

#### èšåˆæ ¹è®¾è®¡åŸåˆ™

```mermaid
classDiagram
class Category {
<<aggregate root>>
-CategoryId id
-CategoryName name
-String icon
-String color
-Integer sort
-boolean enabled
+create(name, icon, color, sort) Category
+rebuild(id, name, icon, color, sort, enabled) Category
+update(name, icon, color, sort) void
+disable() void
+enable() void
+equals() boolean
+hashCode() int
}
class CategoryName {
<<value object>>
-String value
+of(value) CategoryName
+getValue() String
+equals() boolean
+hashCode() int
}
class CategoryId {
<<value object>>
-Long value
+of(value) CategoryId
+getValue() Long
+equals() boolean
+hashCode() int
}
Category --> CategoryName : "ç»„åˆ"
Category --> CategoryId : "ç»„åˆ"
```

**å›¾è¡¨æ¥æº**
- [Category.java](file://src/main/java/com/crazydream/domain/category/model/aggregate/Category.java#L11-L41)
- [CategoryName.java](file://src/main/java/com/crazydream/domain/category/model/valueobject/CategoryName.java#L5-L17)
- [CategoryId.java](file://src/main/java/com/crazydream/domain/shared/model/CategoryId.java#L12-L24)

#### ä¸šåŠ¡æ–¹æ³•å®ç°

| æ–¹æ³• | åŠŸèƒ½ | å‚æ•° | è¿”å›å€¼ |
|------|------|------|--------|
| create | åˆ›å»ºæ–°åˆ†ç±» | åç§°ã€å›¾æ ‡ã€é¢œè‰²ã€æ’åº | Categoryå®ä¾‹ |
| rebuild | é‡å»ºåˆ†ç±» | IDã€åç§°ã€å›¾æ ‡ã€é¢œè‰²ã€æ’åºã€çŠ¶æ€ | Categoryå®ä¾‹ |
| update | æ›´æ–°åˆ†ç±»ä¿¡æ¯ | æ–°çš„åç§°ã€å›¾æ ‡ã€é¢œè‰²ã€æ’åº | void |
| disable | ç¦ç”¨åˆ†ç±» | æ—  | void |
| enable | å¯ç”¨åˆ†ç±» | æ—  | void |

**ç« èŠ‚æ¥æº**
- [Category.java](file://src/main/java/com/crazydream/domain/category/model/aggregate/Category.java#L21-L56)

### å€¼å¯¹è±¡è®¾è®¡

#### CategoryNameå€¼å¯¹è±¡

CategoryNameå®ç°äº†ä¸å¯å˜çš„å€¼å¯¹è±¡è®¾è®¡ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ï¼š

```mermaid
flowchart TD
Input[è¾“å…¥å­—ç¬¦ä¸²] --> CheckNull["æ£€æŸ¥æ˜¯å¦ä¸ºç©º"]
CheckNull --> NullValid{"ä¸ºç©º?"}
NullValid --> |æ˜¯| ThrowError["æŠ›å‡ºIllegalArgumentException"]
NullValid --> |å¦| Trim["å»é™¤é¦–å°¾ç©ºæ ¼"]
Trim --> Create["åˆ›å»ºCategoryNameå®ä¾‹"]
Create --> Return["è¿”å›å€¼å¯¹è±¡"]
ThrowError --> End([ç»“æŸ])
Return --> End
```

**å›¾è¡¨æ¥æº**
- [CategoryName.java](file://src/main/java/com/crazydream/domain/category/model/valueobject/CategoryName.java#L8-L17)

#### CategoryIdå€¼å¯¹è±¡

CategoryIdç¡®ä¿åˆ†ç±»IDçš„æœ‰æ•ˆæ€§ï¼š

- IDå¿…é¡»ä¸ºæ­£æ•´æ•°
- æä¾›ofé™æ€å·¥å‚æ–¹æ³•
- å®ç°ç›¸ç­‰æ€§æ¯”è¾ƒ

**ç« èŠ‚æ¥æº**
- [CategoryName.java](file://src/main/java/com/crazydream/domain/category/model/valueobject/CategoryName.java#L1-L34)
- [CategoryId.java](file://src/main/java/com/crazydream/domain/shared/model/CategoryId.java#L1-L48)

### ä»“å‚¨å±‚å®ç°

#### ä»“å‚¨æ¥å£è®¾è®¡

CategoryRepositoryæ¥å£å®šä¹‰äº†åˆ†ç±»çš„è®¿é—®è§„èŒƒï¼š

```mermaid
classDiagram
class CategoryRepository {
<<interface>>
+save(category) Category
+findById(id) Optional~Category~
+findAll() Category[]
+findEnabled() Category[]
+delete(id) boolean
}
class CategoryRepositoryImpl {
-CategoryPersistenceMapper mapper
+save(category) Category
+findById(id) Optional~Category~
+findAll() Category[]
+findEnabled() Category[]
+delete(id) boolean
}
CategoryRepository <|.. CategoryRepositoryImpl : "å®ç°"
```

**å›¾è¡¨æ¥æº**
- [CategoryRepository.java](file://src/main/java/com/crazydream/domain/category/repository/CategoryRepository.java#L9-L15)
- [CategoryRepositoryImpl.java](file://src/main/java/com/crazydream/infrastructure/persistence/repository/CategoryRepositoryImpl.java#L17-L58)

#### æŒä¹…åŒ–æ˜ å°„

CategoryPersistenceMapper.xmlå®šä¹‰äº†SQLæ“ä½œï¼š

| æ“ä½œ | SQLè¯­å¥ | åŠŸèƒ½ |
|------|---------|------|
| insert | INSERT INTO category | æ’å…¥æ–°åˆ†ç±» |
| update | UPDATE category | æ›´æ–°åˆ†ç±»ä¿¡æ¯ |
| selectById | SELECT * FROM category WHERE id=? | æ ¹æ®IDæŸ¥è¯¢ |
| selectAll | SELECT * FROM category ORDER BY sort ASC | æŸ¥è¯¢æ‰€æœ‰åˆ†ç±» |
| selectByStatus | SELECT * FROM category WHERE status=? ORDER BY sort ASC | æŒ‰çŠ¶æ€æŸ¥è¯¢ |
| deleteById | DELETE FROM category WHERE id=? | åˆ é™¤åˆ†ç±» |

**ç« èŠ‚æ¥æº**
- [CategoryRepository.java](file://src/main/java/com/crazydream/domain/category/repository/CategoryRepository.java#L1-L16)
- [CategoryRepositoryImpl.java](file://src/main/java/com/crazydream/infrastructure/persistence/repository/CategoryRepositoryImpl.java#L1-L59)
- [CategoryPersistenceMapper.xml](file://src/main/resources/mapper/CategoryPersistenceMapper.xml#L1-L47)

## ä¾èµ–å…³ç³»åˆ†æ

### ç»„ä»¶ä¾èµ–å›¾

```mermaid
graph TD
subgraph "æ¥å£å±‚"
CC[CategoryController]
end
subgraph "åº”ç”¨å±‚"
CAS[CategoryApplicationService]
CA[CategoryAssembler]
end
subgraph "é¢†åŸŸå±‚"
C[Category]
CN[CategoryName]
CID[CategoryId]
CR[CategoryRepository]
end
subgraph "åŸºç¡€è®¾æ–½å±‚"
CRI[CategoryRepositoryImpl]
CCV[CategoryConverter]
CPM[CategoryPersistenceMapper]
end
CC --> CAS
CAS --> CA
CAS --> CR
CA --> C
C --> CN
C --> CID
CR --> CRI
CRI --> CCV
CRI --> CPM
CCV --> CPM
CCV --> C
```

**å›¾è¡¨æ¥æº**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java#L3-L16)
- [CategoryApplicationService.java](file://src/main/java/com/crazydream/application/category/service/CategoryApplicationService.java#L3-L18)
- [CategoryRepositoryImpl.java](file://src/main/java/com/crazydream/infrastructure/persistence/repository/CategoryRepositoryImpl.java#L3-L20)

### æ•°æ®æµåˆ†æ

```mermaid
flowchart LR
subgraph "å¤–éƒ¨è¯·æ±‚"
Client[å®¢æˆ·ç«¯]
end
subgraph "åº”ç”¨å±‚"
DTO[CreateCategoryCommand]
Domain[Categoryèšåˆ]
DTOOut[CategoryDTO]
end
subgraph "æŒä¹…åŒ–å±‚"
PO[CategoryPO]
SQL[SQLè¯­å¥]
DB[(MySQL)]
end
Client --> DTO
DTO --> Domain
Domain --> PO
PO --> SQL
SQL --> DB
DB --> SQL
SQL --> PO
PO --> Domain
Domain --> DTOOut
DTOOut --> Client
```

**å›¾è¡¨æ¥æº**
- [CategoryAssembler.java](file://src/main/java/com/crazydream/application/category/assembler/CategoryAssembler.java#L12-L34)
- [CategoryConverter.java](file://src/main/java/com/crazydream/infrastructure/persistence/converter/CategoryConverter.java#L10-L36)

**ç« èŠ‚æ¥æº**
- [CategoryAssembler.java](file://src/main/java/com/crazydream/application/category/assembler/CategoryAssembler.java#L1-L42)
- [CategoryConverter.java](file://src/main/java/com/crazydream/infrastructure/persistence/converter/CategoryConverter.java#L1-L38)

## æ€§èƒ½è€ƒè™‘

### æŸ¥è¯¢ä¼˜åŒ–

1. **ç´¢å¼•è®¾è®¡**ï¼šæ•°æ®åº“è¡¨å·²å»ºç«‹åˆé€‚çš„ç´¢å¼•
2. **æ’åºä¼˜åŒ–**ï¼šæŒ‰sortå­—æ®µæ’åºï¼Œæ”¯æŒå¿«é€Ÿè·å–æœ‰åºåˆ—è¡¨
3. **çŠ¶æ€è¿‡æ»¤**ï¼šæä¾›æŒ‰çŠ¶æ€æŸ¥è¯¢çš„ä¸“ç”¨æ¥å£

### ç¼“å­˜ç­–ç•¥

å½“å‰å®ç°æœªåŒ…å«ç¼“å­˜å±‚ï¼Œå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚è€ƒè™‘ï¼š
- åˆ†ç±»åˆ—è¡¨ç¼“å­˜
- åˆ†ç±»è¯¦æƒ…ç¼“å­˜
- çŠ¶æ€åˆ†ç±»ç¼“å­˜

### æ‰¹é‡æ“ä½œ

ç³»ç»Ÿæ”¯æŒæ‰¹é‡æŸ¥è¯¢æ“ä½œï¼Œä½†æœªå®ç°æ‰¹é‡æ›´æ–°åŠŸèƒ½ã€‚å¯æ ¹æ®éœ€æ±‚æ‰©å±•æ‰¹é‡æ“ä½œæ¥å£ã€‚

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### åˆ†ç±»åç§°éªŒè¯é”™è¯¯

**é—®é¢˜**ï¼šåˆ›å»ºåˆ†ç±»æ—¶æç¤ºåç§°æ— æ•ˆ
**åŸå› **ï¼šåç§°ä¸ºç©ºæˆ–ä»…åŒ…å«ç©ºæ ¼
**è§£å†³**ï¼šç¡®ä¿åç§°éç©ºä¸”å»é™¤é¦–å°¾ç©ºæ ¼

#### åˆ†ç±»IDæ— æ•ˆ

**é—®é¢˜**ï¼šæ›´æ–°æˆ–åˆ é™¤åˆ†ç±»æ—¶æŠ¥IDæ— æ•ˆ
**åŸå› **ï¼šIDä¸ºç©ºæˆ–éæ­£æ•°
**è§£å†³**ï¼šç¡®ä¿æä¾›æœ‰æ•ˆçš„æ­£æ•´æ•°ID

#### æ•°æ®åº“çº¦æŸå†²çª

**é—®é¢˜**ï¼šåˆ†ç±»åç§°é‡å¤å¯¼è‡´æ’å…¥å¤±è´¥
**åŸå› **ï¼šæ•°æ®åº“å”¯ä¸€çº¦æŸ
**è§£å†³**ï¼šæ£€æŸ¥ç°æœ‰åˆ†ç±»æˆ–ä¿®æ”¹åç§°

### é”™è¯¯å“åº”ç 

| çŠ¶æ€ç  | é”™è¯¯ç±»å‹ | è¯´æ˜ |
|--------|----------|------|
| 200 | æˆåŠŸ | æ“ä½œæˆåŠŸæ‰§è¡Œ |
| 400 | å‚æ•°é”™è¯¯ | è¯·æ±‚å‚æ•°æ— æ•ˆ |
| 401 | æœªæˆæƒ | JWTè®¤è¯å¤±è´¥ |
| 404 | èµ„æºä¸å­˜åœ¨ | åˆ†ç±»IDä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | ç³»ç»Ÿå†…éƒ¨é”™è¯¯ |

**ç« èŠ‚æ¥æº**
- [CategoryController.java](file://src/main/java/com/crazydream/interfaces/category/CategoryController.java#L23-L81)

## ç»“è®º

åˆ†ç±»ç®¡ç†æ¨¡å—é€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡å’Œä¸¥æ ¼çš„ä¸šåŠ¡è§„åˆ™å®ç°ï¼Œä¸ºCrazyDreamç›®æ ‡ç®¡ç†ç³»ç»Ÿæä¾›äº†ç¨³å®šå¯é çš„åˆ†ç±»ç®¡ç†èƒ½åŠ›ã€‚æ¨¡å—å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **æ¸…æ™°çš„æ¶æ„åˆ†å±‚**ï¼šéµå¾ªDDDå’ŒCOLAå››å±‚æ¶æ„åŸåˆ™
2. **å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘**ï¼šå®ç°äº†åˆ†ç±»çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
3. **ä¸¥æ ¼çš„æ•°æ®çº¦æŸ**ï¼šé€šè¿‡å€¼å¯¹è±¡ç¡®ä¿æ•°æ®å®Œæ•´æ€§
4. **è‰¯å¥½çš„æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºåŠŸèƒ½æ‰©å±•
5. **å®Œå–„çš„é”™è¯¯å¤„ç†**ï¼šæä¾›å‹å¥½çš„é”™è¯¯å“åº”æœºåˆ¶

è¯¥æ¨¡å—ä¸ºåç»­çš„åŠŸèƒ½æ‰©å±•å¥ å®šäº†åšå®çš„åŸºç¡€ï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå®ç°æ›´å¤æ‚çš„åˆ†ç±»ç®¡ç†åŠŸèƒ½ã€‚

## é™„å½•

### APIæ¥å£å®Œæ•´æ–‡æ¡£

#### åˆ›å»ºåˆ†ç±»

**è¯·æ±‚**ï¼š
```
POST /api/v2/categories
Content-Type: application/json
Authorization: Bearer <token>

{
    "name": "åˆ†ç±»åç§°",
    "icon": "å›¾æ ‡emoji",
    "color": "é¢œè‰²å€¼",
    "sort": æ’åºåºå·
}
```

**å“åº”**ï¼š
```json
{
    "code": 200,
    "message": "æˆåŠŸ",
    "data": {
        "id": 1,
        "name": "åˆ†ç±»åç§°",
        "icon": "å›¾æ ‡emoji",
        "color": "é¢œè‰²å€¼",
        "sort": æ’åºåºå·,
        "enabled": true
    }
}
```

#### è·å–æ‰€æœ‰åˆ†ç±»

**è¯·æ±‚**ï¼š
```
GET /api/v2/categories
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
    "code": 200,
    "message": "æˆåŠŸ",
    "data": [
        {
            "id": 1,
            "name": "åˆ†ç±»åç§°",
            "icon": "å›¾æ ‡emoji",
            "color": "é¢œè‰²å€¼",
            "sort": æ’åºåºå·,
            "enabled": true
        }
    ]
}
```

#### è·å–å¯ç”¨çš„åˆ†ç±»

**è¯·æ±‚**ï¼š
```
GET /api/v2/categories/enabled
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
    "code": 200,
    "message": "æˆåŠŸ",
    "data": [
        {
            "id": 1,
            "name": "åˆ†ç±»åç§°",
            "icon": "å›¾æ ‡emoji",
            "color": "é¢œè‰²å€¼",
            "sort": æ’åºåºå·,
            "enabled": true
        }
    ]
}
```

#### è·å–åˆ†ç±»è¯¦æƒ…

**è¯·æ±‚**ï¼š
```
GET /api/v2/categories/{id}
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
    "code": 200,
    "message": "æˆåŠŸ",
    "data": {
        "id": 1,
        "name": "åˆ†ç±»åç§°",
        "icon": "å›¾æ ‡emoji",
        "color": "é¢œè‰²å€¼",
        "sort": æ’åºåºå·,
        "enabled": true
    }
}
```

#### æ›´æ–°åˆ†ç±»

**è¯·æ±‚**ï¼š
```
PUT /api/v2/categories/{id}
Content-Type: application/json
Authorization: Bearer <token>

{
    "name": "æ–°åç§°",
    "icon": "æ–°å›¾æ ‡",
    "color": "æ–°é¢œè‰²"
}
```

**å“åº”**ï¼š
```json
{
    "code": 200,
    "message": "æˆåŠŸ",
    "data": {
        "id": 1,
        "name": "æ–°åç§°"
    }
}
```

#### åˆ é™¤åˆ†ç±»

**è¯·æ±‚**ï¼š
```
DELETE /api/v2/categories/{id}
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
    "code": 200,
    "message": "æˆåŠŸ",
    "data": true
}
```

### æ•°æ®æ¨¡å‹å­—æ®µè¯´æ˜

#### Categoryå®ä½“å­—æ®µ

| å­—æ®µå | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| id | Long | å¦ | è‡ªåŠ¨åˆ†é… | åˆ†ç±»å”¯ä¸€æ ‡è¯†ç¬¦ |
| name | String | æ˜¯ | æ—  | åˆ†ç±»åç§°ï¼Œé•¿åº¦é™åˆ¶50å­—ç¬¦ |
| icon | String | å¦ | null | åˆ†ç±»å›¾æ ‡ï¼Œæ”¯æŒemoji |
| color | String | å¦ | null | åˆ†ç±»é¢œè‰²ï¼Œåå…­è¿›åˆ¶æ ¼å¼ |
| sort | Integer | å¦ | 0 | æ’åºåºå·ï¼Œç”¨äºåˆ—è¡¨æ’åº |
| enabled | Boolean | å¦ | true | æ˜¯å¦å¯ç”¨çŠ¶æ€ |

#### æ•°æ®åº“è¡¨ç»“æ„

```sql
CREATE TABLE category (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL COMMENT 'åˆ†ç±»åç§°',
    icon VARCHAR(50) DEFAULT NULL COMMENT 'åˆ†ç±»å›¾æ ‡',
    color VARCHAR(20) DEFAULT NULL COMMENT 'åˆ†ç±»é¢œè‰²',
    sort INT DEFAULT 0 COMMENT 'æ’åº',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼ˆ1:æ­£å¸¸, 0:ç¦ç”¨ï¼‰',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åˆ†ç±»è¡¨';
```

### ä½¿ç”¨ç¤ºä¾‹

#### Javaé›†æˆç¤ºä¾‹

```java
// åˆ›å»ºåˆ†ç±»
CreateCategoryCommand command = new CreateCategoryCommand();
command.setName("å­¦ä¹ æˆé•¿");
command.setIcon("ğŸ“š");
command.setColor("#2ecc71");
command.setSort(2);

CategoryDTO result = categoryService.createCategory(command);

// è·å–æ‰€æœ‰åˆ†ç±»
List<CategoryDTO> categories = categoryService.getAllCategories();

// æ›´æ–°åˆ†ç±»
Map<String, Object> payload = new HashMap<>();
payload.put("name", "æ›´æ–°åçš„åˆ†ç±»åç§°");
CategoryDTO updated = categoryService.updateCategory(1L, payload);
```

#### å‰ç«¯é›†æˆç¤ºä¾‹

```javascript
// è·å–åˆ†ç±»åˆ—è¡¨
fetch('/api/v2/categories', {
    headers: {
        'Authorization': 'Bearer ' + token
    }
})
.then(response => response.json())
.then(data => console.log(data.data));

// åˆ›å»ºæ–°åˆ†ç±»
fetch('/api/v2/categories', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({
        name: 'æ–°åˆ†ç±»',
        icon: 'ğŸ¯',
        color: '#3498db',
        sort: 1
    })
})
.then(response => response.json())
.then(data => console.log(data.data));
```

**ç« èŠ‚æ¥æº**
- [api-documentation.md](file://api-documentation.md#L410-L575)
- [schema.sql](file://src/main/resources/schema.sql#L26-L36)